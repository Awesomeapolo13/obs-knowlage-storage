
# Управление памятью и ресурсами

**Связи:**
- Обратные
	- [PHP-FPM](php-fpm);
- Прямые:
	

**Хештеги:** #Programming/PHP/PHP-FPM

## Архитектура

PHP-FPM использует подход "share-nothing" - каждый worker имеет изолированную память. Благодаря:
- нет разделяемых данных между запросами разных процессов
- память запроса полностью очищается после RSHUTDOWN
- исключены race conditions и взаимное влияние процессов

## Расчет ресурсов

Формула для расчета максимального количества процессов выглядит так:

`pm.max_children = (Доступная RAM - Системные процессы) / Память на процесс`

Пример для сервера с 8GB RAM:
Система: ~2GB
Доступно: 6GB = 6144MB
Память на процесс: ~60MB (измерить через ps_mem.py)
Максимум процессов: 6144/60 ≈ 100

## Конфигурация управления памятью

```ini
# Лимит памяти на PHP-скрипт
memory_limit = 256M
# Количество запросов до перезапуска процесса (против утечек)
pm.max_requests = 500
# Таймаут принудительного завершения
request_terminate_timeout = 60s
# Slowlog для профилирования
slowlog = /var/log/php8.3-fpm-slow.log
request_slowlog_timeout = 5s
```
