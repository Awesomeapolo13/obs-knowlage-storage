
**Связи:**
- Обратные
	- [Программирование](PROGRAMMING);
- Прямые:
	- [Полезные команды](Php-commands);
	- [Статические переменные](Static-variables);
	- [Статические анализаторы кода](static-code-analizers);

**Хештеги:** #Programming/PHP

## Определение и особенности

**PHP** - синхронный, интерпертируемый, серверный язык программирования, используемый преимущественно для веб-разработки.

**PHP (Hypertext Preprocessor)** — это широко используемый язык программирования с открытым исходным кодом, особенно подходящий для веб-разработки и встраиваемый в HTML. Вот некоторые ключевые особенности, сильные и слабые стороны PHP:

- **Серверный Скриптовый Язык:** PHP в основном используется для серверной разработки, что означает, что скрипты PHP выполняются на сервере, а результаты отправляются клиенту.
- **Легко Встраиваемый в HTML:** PHP может легко встраиваться в HTML-код, что делает его удобным для создания динамических веб-страниц.
- **Большая Стандартная Библиотека:** PHP имеет обширную стандартную библиотеку, включающую широкий спектр встроенных функций для работы с файлами, базами данных, сессиями и многим другим.
- **Поддержка Баз Данных:** PHP поддерживает широкий спектр систем управления базами данных.
- **Кроссплатформенность:** PHP может работать на различных операционных системах, таких как Linux, Windows и macOS.

### История

Создан 08.06.1995 Расмусом Лефордом. Изначально назывался PHP Tools (Personal Home Page Tools). Создавался как интерпретатор шаблонов (шаблонизатор) для ускорения веб-разработки. В 1998 году полностью переписан на C.

### Достоинства

- требует мало времени на изучение;
- много возможностей при хорошем владении;
- кроссплатформенность (запускается на любой ОС);
- поддержка веб-серверов;
- бесплатное распространение;
- достаточная производительность;
- большое количество учебных материалов.
- непрерывное развитие.

### Недостатки

- узкопрофильность (используется только в веб);
- безопасность;
- противоречия в коде (много всего из разных языков, в том числе плохого);

## Как работает

1) Web-сервер получает запрос из браузера клиента (или от приложения).
2) Web-сервер формирует запрос к PHP-интерпретатору.
3) PHP-интерпретатор обрабатывает его, получает небходимые данные и возвращает их в каком либо формате (json, xml, html) web-серверу.
4) Web-сервер отправляет данные клиенту.

## Свойства

1) Написан на C
2) Интерпретируемый (Компилируемый), т.к. все преобразуется в байт код.
3) Динамически типизируемый

## Компиляция

1) Лексический анализ
	- В общем случае:
		- у нас есть какой-то текст (код программы);
		- разбираемся из чего она состоит (слова, знаки препинания и пр.)
		- эти составляющие называются "лексемы";
	- В PHP:
		- движок PHP ищет знакомые ему лексемы с помощью re2c (по сути анализ регуляркой);
		- механизм разбиваем программу на эти лексемы
		- каждой лексеме подбирается подходящий токен (T_FUNCTION, T_VARIABLE и др.)
		- в итоге написанный код превращается в массив токенов (пример ниже, так же можно посмотреть лексемы кода, обернув его в `$code = <<<'CODE' CODE;` и вызвав функцию \PHPToken::tokenize($code) - результат вывести через foreach);

			![[Pasted image 20240219111951.png]]

		- так же php может разирать и другие строки на человеческом языке:
			- JSON;
			- дата/время;
			- SQL (PDO);
			- URL и др.
	- Итоги:
		- массив токенов;
		- php отметил знакомые ему слова;
		- теперь надо проверить корректно ли слова включаются в предложения;
2) Синтаксический анализ:
	- группирует операции, условно это:
		- представляет массив токенов как очень длинное математическое выражение;
		- для вычисления выражения "расставляет в нем скобочки";
		- Фрома Бэкуса-Наура - способ описания грамматики языка (её аналоги часто встречаются в документации), она есть и для php, в ней желательно разобраться;
	- В PHP:
		- для php есть своя грамматика языка;
		- программа GNU Bison берёт эту грамматику и генерирует парсер(прога которая генерируется на компе в момент компиляции PHP);
		- парсер применяет грамматику к массиву токенов;
		- в результате масси превращается в AST - абстрактное синтаксическое дерево (astexplorer.net - тут можно на любом ЯП написать код и посмотреть его AST), в котором:
			- корень - самое начало программы;
			- каждый узел - отдельная операция;
			- дочерние узлы - аргументы этой операции;
			![[Pasted image 20240219135517.png]]
	- Итоги:
		- PHP разобрался, какие операции упоминаются в коде;
		- после чего сгруппировал их в нужном порядке;
		- теперь нам нужно сделать так, чтобы эти операции запустились на компьютере.
3) Компиляция:
	- проверяет семантику (смысл написанного, причемоднозначный);
	- превращает дерево с исходным кодом в опкоды (PHP запускается не на процессоре, а внутри специальной виртуальной машине PHP Zend Engine, которая умеет выполнять промежуточные инструкции - опкоды);
	- виртуальная машина нужна чтобы запускать код на любом устойстве, поддерживающем php, независимо от её архитектуры (абстрагировать процесс php от реального процесса);
	- В PHP:
		- PHP рекурсивно обходит AST в несколько подходов;
		- при этом происходит оптимизация дерева;
		- в итоге дерево превращается в набор опкодов;
		- при этом для каждой функции готовится массив опкодов плюс информация о переменных, которые в них нужно подставить;
		- Опкоды (https:/3v4l.org/ - тут можно посмотреть опкоды):
			- выполняют сравнительно простые операции;
			- порядок выполнения - строго по очереди;
			- для циклов, условных выражений и др, используются опкоды напоминающие GOTO.
4) Запуск программы (Runtime):
	- для запуска программы неоьходимо:
		- комманды, которые будет выполнять программа;
		- данные, которые она будет обрабатывать;
		- память, где всё это будет размещаться.


## Модель памяти

В режиме web-server php может обрабатывать несколько запросов. Для каждого из них запускается отдельный процесс (т.е. отдельная копия кода php). Каждому процессу выделяется оперативная память.

При старте PHP, независимо от того какого она размера, выделяется 2Mb. Принеобходимости процесс может запросить дополнительную память. Новая память выделяется чанками, обычно, по 2Mb. Процесс не сможет получить дополнительную память либо, если кончилась оперативная память, либо если текущая память превышет указанную в `php.ini` файле в параметре `max_memory`.

Память состоит из двух частей. Первая называется стек -  тут лежат маленькие переменные, необходимые для работы конкретных функций. Вторая, более крупная часть, куча - здесь хранятся крупные переменные, массивы, объекты и пр.

В языках со статической типизацией (строгой) переменные создаются черех объявление типа и, затем, присваивание значения. Изменить тип в дальнейшем невозможно. Благодаря этому, переменная будет всегда занимать строго фиксированное количество байт.
`zval` - способ представления переменных внутри php.

