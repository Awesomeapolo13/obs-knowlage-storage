
# Масштаблирование

**Ключи:**
- Обратные:
	- [High load](high-load);
- Прямые:
	- [Масштабирование](high-load-scalability)

**Хештеги:**
- #Highload

## Определение

**Масштабирование** - механизм позволяющий выдержать и обработать большую нагрузку.

**Вертикальное масштаблирование** - добавляем ресурсы на текущую машину (больше памяти, более мощное железо).
- не нужно переписывать код;
- дёшево в малых количествах - никаких усилий, просто добавил за деньги ещё;
- дорого - с какого-то момента становится уже дорого;
- не всегда возможно "на лету" - возможно придется выключить приложение на время масштабирования.

**Горизонтальное масштабирование** - не увеличиваем ресурс одной машины, а берем количеством таких машин, размещая на них копии приложений. Это можно провернуть, добавлением серверов (+10 машин не значит, что работаем в 10 раз быстрее), можно собрать из приложений независимые кластеры и балансировать нагрузку.
- ресурсы ограничены только финансовыми возможностями;
- переработка архитектуры;
- переписываение кода;
- значительные DevOps-затраты на инициализацию процесса.

## Этапы

### Вертикальное

1) Вынести на отдельный сервер отчуждаемые части системы (кэш, БД, микросервисы);
2) Определить источнык проблемы - наиболее поглощающее ресрсы приложение/сервис, так называемый *greedy service* (GS - не общепринятое название);
3) Максимально изолируем **GS**;
4) Увеличиваем ресурсы на сервере с **GS**, пока есть возможность.
5) Если ничего не помогла, то нужно задуматься о горизонтальном масштабировании

### Горизонтальное

1) Кластеризация источников данных (БД, кеш и пр.) - делим/дробим источники данных;
2) Еси нет CI CD, то самое время задуматься об этом (контейнеризация и виртуализация GS) - т.е. появляется множество копий одного сервиса, нужен механизм, чтобы все они получили обновление одновременно;
3) Холостой балансировщик нагрузки - пока на единственную машину, чтобы сделать хотя бы один рабочий и стабильный вариант;
4) Увеличиваем количество инстансов **GS**;
5) Пока есть возможность, для каждого инстанса можно добавить вертикального масштабирования.

## Впоросы

1) Как понять что пора масштабироваться?
	- задачи от бизнеса, требующие выдерживания больших нагрузок (планирование распродаж);
	- нагрузочное тестирование.
2) Какой очень важный этап ма пропустили при обсуждении?
	- оптимизация кода (никто не хочет масштабировать хаос);
	- перед масштабированием нужно убедиться, что приложение этого достойно.
3) Как масштабировать монолитное приложение?
	- сделать несколько инстансов монолита;
	- сделать из него микросервисы.
4) Когда можно не думать о вертикальном масштабировании сразу начинать горизонтальное?
	- использовали весь CPU;
	- улучшение отказоустойчивости.