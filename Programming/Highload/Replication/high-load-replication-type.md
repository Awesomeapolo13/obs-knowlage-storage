
# Виды репликации

**Ключи:**
- Обратные:
	- [High load](high-load);
	- [Виды репликации](high-load-replication-type);
- Прямые:

**Хештеги:**
- #Highload/Replication 

## По составу участников

![[Pasted image 20240628165021.png]]


1) *Single leader* (Master-Slave, Leader-Follower) - самый простой и популярный механизм, более 80% репликаций выглядит так.
	- Один лидер, много реплик;
	- Из реплик все читают, а обновляют записи только лидера.

![[Pasted image 20240628170238.png]]


2) *Multi leader* - несколько инстансов БД выступают лидером
	- Несколько кластеров single leader + conflict resolver;
	- Может вызывать конфликты;
	- Без конфликт резолвера работать не будет;
	- Система сложная, из-за доп сущности конфлик ресолвера;
	- Может быть вырожденный случай, когда есть лишь лидеры и конфликт резолвер.

![[Pasted image 20240628170417.png]]

3) *Leaderless* - нет лидера совсем
	- Чтобы что-то записать используется алгоритм консенсуса (их может быть много);
	- Таких алгоритмов может быть много, например, все должны быть за (опрашиваем всех, если все согласны - делаем запись) или простое большинство;
	- Устойчив к отключению узлов (мастер упал - все плохо, здесь же, одна упала - остальные договариваются дальше);
	- Блокчейн.

![[Pasted image 20240628170522.png]]

## По гарантии доставки

1) Синхронная (используется редко)
	- Пишем в лидер, но не сразу возвращаем ответ, а спрашиваем реплики;
	- Ждем подтверждения от реплики, только после этого возвращаем ответ источнику;
	- Гарантирует сильную согласованность данных;
	- Медленный ответ.

2) Асинхронная
	- Отвечаем сразу после записи в лидера, подтверждение от реплики приходит позднее;
	- Либо мастер отправляет пуш репликам, либо они сами опрашивают его с какой то периодичностью;
	- Не гарантирует сильной согласованности данных;
	- Гарантирует согласованность в конечном счете;
	- Быстрый ответ.

Рисунок синхронной и асинхронной репликации
![[Pasted image 20240628174139.png]]

3) Семисинхронная
	- В мастер делаетсч запись;
	- Дожидаемся подтверждения от реплик о получении запроса на запись;
	- Отвечаем пользователю после получения подтверждения от всех реплик;
	- Не гарантирует сильную согласованность данных (но не так сильно как асинхронная);
	- Гарантирует согласованность в конечном счете.

## По способу передачи данных


## Вопросы

1) Что будет с системой лидер + синхронная реплика, если реплика выйдет из строя?
	- Зависит от настройки;
	- Если связка жесткая, то всё упадет;
2) В каких ситуауциях имеет смысл только синхронная репликация?
	- финансовые операции;
	- любые чувствительные данные (за операции с которыми могут наступить юридические последствия);
3) С каким максимальным числом узлов имеет смысл синхронная leaderless репликация?
	- в зависимости от алгоритма будет разное число;
	- в зависимости от доступности БД;
	- если около 10 и более таких реплик то слишком долго ждать ответа и могут быть таймауты;
