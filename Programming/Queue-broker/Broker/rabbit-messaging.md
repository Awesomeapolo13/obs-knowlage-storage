# Доставка сообщений

**Связи:**
- Обратные
	- [RabbitMQ](rabbit-mq);
- Прямые:

**Хештеги:**
- #Queue/Broker ;
- #Rabbit 

## Без гарантии доставки

- Basic.publish;
- Просто настроить;
- Нет оверхеда.

Говорим реббиту просто принять сообщение и всё.

Подтверждение работает следующим образом:
- хендщейк - паблишер шлет сообщение, реббит ему отвечает, что он готов;
- Basic.publish - отправляем реббиту рабочее сообщение, он отвечает кодом, что все принял.

![[Pasted image 20240617164024.png]]

Благодаря тому, что мы ждем ответ от реббита, мы можем получить замедление примерно на 20-30%.

## Сохранение на диск

- Отправляем в реббит сообщение;
- Реббит записывает на диск сообщение;
- Далее реббит отправляет в очередь указатель на это сообщение;
- На диске отслеживается количество указателей на сообщение;
- Как только количество указателей становится равно 0, сообщение удаляется с диска.

![[Pasted image 20240618104130.png]]

При большом потоке сообщений и плохой настройке буфера ОС, может привести к значительному замедлению.
Для активации такого поведения нужно передать в сообщении `delivery-mode 2`. 

