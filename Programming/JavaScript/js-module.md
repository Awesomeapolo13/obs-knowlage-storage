
# Модули в JS

## Зачем они нужны

- Повторное использование.
- Возможность компоновки.
- Удобство разработки.
- Изоляция.
- Организация проекта.

## История

![[Pasted image 20230122191555.png]]

1) Intermediate Involced Function Expression (IIFE) - первый паттерн для модульности JS. Функции которые можно было выполнить мгновенно один раз.
	- важен порядок выполнения скриптов;
	- работало только в браузерах.
2) Common JS modules - раньше являлся стандартом, на нем был основан  Node.js.
	- использовался в браузере только для сборок bundle;
	- использовался в Node.js для всего.
3) ES modules - стандарт для динамического подключения модулей как в браузере так и в Node.

## Common JS

1) Создаем файл test.js пишем функцию и указываем что модуль будет экспортировать

```js
const users = ['Word1', 'Word2'];

function greet (name) {
	console.log(`Hello ${name}`);
}

module.exports = {users, greet};
```

2) Берем файл из п.1 и подключаем в другой файл app.js

```js
const {users, greet} = require('./test.js');

for (const user of users) {
	greet(user);
}
```

!! Функция require существует только в node.js, в браузере его нет.

## ES module

1) Создадим файл test2.mjs и сипользуем в нем ключевое слово *export*

```js
export const users = ['Word1', 'Word2'];

export function greet(name) {
	console.log(`Привет ${name}`)
}
```

2) В файле app.mjs вызовем модуль из п.1 с помощью ключевого слова import

```js
import { users, greet } from './test2.mjs';

for (const user of users) {
	greet(user);
}
```

## Различия

ES module вошел в ноду только в 13 версии.
Поддержка TypeScript есть в обоих способав модулирования.

### CommonJS

- Require в любом месте.
- Можно использовать в условии.
- Загрузка всего из модуля.
- Нет асинхронности.

### ES modules

- Импорт на верхнем уровне.
- Нельзя использовать в условии.
- Выборочная загрузка.
- Асинхронное подключение (тут можно использовать в условии).

## Использование ES modules в Node

- Использовать файлы JS с расширением .mjs (изначальный способ, для обратной совместимости);
- Указать в package.json "type": "module" - тогда все файлы приложения будут интерпертироваться как модули;
- Передать node аргумент --input-type=module

**Ключи:**
- [Программирование](PROGRAMMING);
- [JS](javascript);
- [Node.js](node-js);

**Хештеги:** #Programming/JS