
# Управление зависимостями в npm

Чтобы найти пакет можно воспользоваться интерфейсом сайта npm или же ввести команду ниже:

```shell
npm search http
```

В данном случае он будет искать пакеты работающие с http (по названию пакетов).

После установки требуемого пакета в packege.json появляется новая область `dependencies`. В ней находится объект с именами пакета в качестве ключей и строки версий этих пакетов, в качестве значений к ключам. В этой области перечисленны все пакеты необходимые для работы нашего приложения (именно для работы).

Работа с версионированием:
- "^0.21.4" - означает, что можем обновлять все кроме мажорной версии;
- "0.21.4" - нужно установить четко эту версию;
- "~0.21.4" - разрешает при оьновлении поднимать только версии фиксов.

Обновления, не касающиеся мажорной версии, не должны ломать сборки приложения, но это не всегда так. Поэтому лучше фиксировать версию для стабильной рабты приложения.

После установки пакета генерируется файл package-lock.json. Это файл в котором фиксируются версии установленных пакетов. Т.е. если мы ставим с помощью npm ci, то мы получим версии, казанные в package.json.

Так же после установки пакета появляется дирекотрия node-modules. Туда сохраняются скачанные пакеты, а так же пакеты необходимые для их работы. Например, для работы axious нужна библиотека follow-redirects, поэтому при его (axious) скачивании мы установим не один пакет, а сразу два.

Директория `node-modules` должна быть помещена в `.gitignore`.

Пакеты должны устанавливаться по мере необходимости реализации некоторого функционала, например http-client. Не нужно скачивать пакеты реализующие небольшие простые функции (типа определения четности и нечетности числа).

NPM предлагает специальную утилиту для проверки наших зависимостей на потенциальную небезопасность. Эта утилита сверяет пакеты и версии установленные в нашем приложении с теми, что находятся в её базе данных.

```shell
npm audit
```

!!! Данная утилита не является 100% защитой, поскольку она покажет только уже официально найденные и подтвержденные уязвимости. Если о какой-то уязвимости не известно в её БД, то её пропустят.

Команда `npm ci` сносит  `node-modules` и переставляет их. Это чистая установка, которая учитывает `package-lock.json`. 

Команда `npm fund` - позволяет получить все фандинги (адреса репозиторие и др. информацию) пакетов, используемых в проекте.

Команда `npm dedup` - дедуплицирует зависимости.

Команда `npm audit fix --force` - поднимает версии зависимотстей уязвимых пакетов до неуязвимых.

Команда `npm cache verufy` - используется для обновления кеша, например, в случаях когда есть ошибки при установке или обновлении пакетов (кеш может ломать корректную установку и обновление).

Команда `npm cache clear` - чистит локальный кеш npm, чтобы он все брал снова с сайта.

## Виды зависимостей

1) `dependencies`  - в этой области перечисленны все пакеты необходимые для работы нашего приложения (именно для работы).
2) `devDependencies` - зависимости, необходимые для разработки, но которые не нужны на проде.
3) `peerDependencies` - позволяют указать какие зависимости нужны для работы конкретного пакета. Например, плагины для некоторых пакетов, чтобы обеспечить их совместимость с текущей версией некоторого пакета.
4) `peerDependenciesMeta` - мета информация для пунктв 3, например, выбрасывать ли ошибку, при несовместимости версий пакетов. Например, если нет каких либо зависимостей, можем пропустить их ошибки. Т.е. зависимости в п.3 и п.4 позволяют делать зависимости опциональными
5) `optionalDependencies` - используется, чтобы установить опциональные зависимости, если же такой зависимости нет, то ошибки не будет. При этом на стороне разработки нужно приложить усилия для того, чтобы отсутствие опциональной зависимости не ломало приложение.

Чаще всего на практике будут использоваться зависимости из п.1 и 2. иногда п.3

**Ключи:**
- [Node.js](node-js);
- [Node Package Manager (NPM)](npm);
- [Package.json](package-json);

**Хештеги:** #Programming/JS/NodeJs/NPM