
# CQRL и принцип подстановки Барбары Лисков

**Ключи:**
- Обратные:
	-  [CQRS](CQRS);

**Хештеги:** #Programming/Arch/CQRS

## Определение

Принцип подстановки Барбары Лисков (LSP, Liskov Substitution Principle) является одним из пяти принципов SOLID в объектно-ориентированном программировании. Этот принцип утверждает, что объекты в программе должны быть заменяемыми на экземпляры их подтипов без изменения правильности работы программы.

Применение LSP в контексте CQRS (Command Query Responsibility Segregation) обеспечивает, что расширения или изменения в обработке команд (Commands) и запросов (Queries) не нарушают ожидаемое поведение системы.

## Пример

Рассмотрим пример с декоратором, который мы обсуждали ранее. Если мы создаем декоратор для обработчика команд, согласно LSP, этот декоратор должен быть взаимозаменяем с оригинальным обработчиком команд. Это означает, что декоратор должен следовать тому же интерфейсу, что и оригинальный обработчик.

Интерфейс Обработчика Команд

```php
interface CommandHandlerInterface {
    public function handle($command);
}
```

Реализация и Декоратор

```php
class CreateUserCommandHandler implements CommandHandlerInterface {
    public function handle($command) {
        // Логика создания пользователя
    }
}

class LoggingCommandHandlerDecorator implements CommandHandlerInterface {
    private $wrappedHandler;

    public function __construct(CommandHandlerInterface $handler) {
        $this->wrappedHandler = $handler;
    }

    public function handle($command) {
        // Дополнительная логика (логирование)
        $this->wrappedHandler->handle($command);
        // Дополнительная логика может быть здесь
    }
}

```

В этом примере `LoggingCommandHandlerDecorator` декорирует `CreateUserCommandHandler`, но также следует интерфейсу `CommandHandlerInterface`. Это означает, что декоратор может заменить оригинальный обработчик команд без нарушения работы программы, что соответствует принципу подстановки Лисков.

## Примерение в CQRS

1. **Соблюдение Контрактов:** Обработчики команд и запросов должны строго следовать определенным интерфейсам или абстрактным классам.

3. **Предсказуемость Поведения:** Расширения или изменения в обработчиках (например, через наследование или декорирование) не должны менять ожидаемое поведение этих обработчиков.

4. **Заменяемость:** Клиентский код, использующий обработчики команд или запросов, должен иметь возможность работать с любой реализацией интерфейса без знания о конкретном типе обработчика и без изменения правильности работы.

Соблюдение принципа подстановки Лисков в контексте CQRS помогает обеспечить, что система остается модульной и расширяемой, позволяя легко вносить изменения и улучшения без риска нарушения существующей функциональности.