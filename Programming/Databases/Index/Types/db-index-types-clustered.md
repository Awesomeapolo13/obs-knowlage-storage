
# Кластеризованные индексы

**Ключи:**
- Обратные:
	- [Индексы](db-index);
	- [Типы индексов](db-index-types);

**Хештеги:** #Programming/Databases/Index/Types

## Определение

Кластеризованный индекс — это особый тип индекса, который определяет физический порядок хранения строк данных в таблице базы данных. В отличие от некластеризованных индексов, которые хранят только ссылки на данные, кластеризованный индекс фактически упорядочивает данные в соответствии с ключом индекса. Это означает, что в таблице может быть только один кластеризованный индекс, поскольку не может быть двух разных способов физического упорядочивания данных в одной и той же таблице.

Когда кто-то говорит, что данные не хранятся в таблице каким либо определенным образом, имеется ввиду, сколько механизмов БД работает по умолчанию. Механизмы БД позволяют хранить данные в порядке, указанном пользователем. Такие виды таблиц и называются **кластеризованными индексами** (SQL Server) или **индексно-оргазованными таблицами** (Oracle).

Такой вид структуры, это смесь таблицы и индекса. Данные ключевого столбца индекса упорядочены (как в индексе), но вместо указателя на то место, где фактические данные находятся в таблице, он включает остальные данные (выделенные зеленым цветом на рисунке ниже), после проиндексированного столбца или столбцов (выделены синим цветом). 

![[Pasted image 20230731092956.png]]

## Зачем нужен

1. **Быстрый доступ к данным**: Поскольку кластеризованный индекс определяет физический порядок хранения данных, операции чтения, которые извлекают большие объемы последовательных данных, становятся более эффективными.
2. **Упорядоченное хранение**: Данные автоматически хранятся в упорядоченном виде, что упрощает и ускоряет операции сортировки и диапазонные запросы.
3. **Оптимизация некоторых типов запросов**: Запросы, использующие операторы `BETWEEN`, `>`, `<`, `>=`, `<=`, могут выполняться быстрее, так как данные уже физически упорядочены.

## Как создать

Во многих СУБД, включая Microsoft SQL Server и некоторые версии MySQL (InnoDB), кластеризованный индекс автоматически создается при определении первичного ключа таблицы. Если вы явно не создаете кластеризованный индекс, СУБД может использовать первичный ключ как кластеризованный индекс.

- Если вы не создаете кластеризованный индекс явно, СУБД может выбрать подходящий столбец для его создания на основе первичного ключа.
- Изменение кластеризованного индекса может быть дорогостоящей операцией, поскольку это влияет на физический порядок хранения данных в таблице.
- Правильный выбор столбца для кластеризованного индекса может значительно улучшить производительность запросов, особенно для больших объемов данных.

Пример MySQL:

```sql
CREATE TABLE employees (
    employee_id INT AUTO_INCREMENT,
    name VARCHAR(100),
    position VARCHAR(100),
    department VARCHAR(100),
    PRIMARY KEY (employee_id)
) ENGINE=InnoDB;
```
