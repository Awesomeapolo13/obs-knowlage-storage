
# REPLACE

**Ключи:**
- Обратные:
	- [MySQL](MySQL);
	- [Модификация данных MySQL](mysql-modifying-data);
- Прямые:
	- [INSERT](mysql-insert);
	- [INSERT INTO SELECT](mysql-insert-select);
	- [UPDATE](mysql-update);

**Хештеги:** 
- #Programming/Databases/MySQL/Modify

## Определение

Выражение `REPLACE` в MySQL - это расширение SQL стандарта. Это выражение работает следующим образом:

- Вставляет новую строку в таблицу, если возникает ошибка дублирования ключа.
- Если вставка не удалась из-за ошибки дублирования ключа:
	- удаляет из таблицы конфликтующую строку, которая вызывает ошибку дублирования ключа;
	- вновь вставляет новую строку в таблицу.

Чтобы определить, существует ли новая строка в таблице, MySQL использует индекс `PRIMARY KEY` или `UNIQUE KEY` . Если в таблице нет ни одного из этих индексов, выражение `REPLACE` работает как выражение `INSERT`.

Чтобы использовать оператор REPLACE, необходимо иметь как минимум привилегии INSERT и DELETE для таблицы.

## Синтаксис

### Вставка новой строки

Синтаксис для вставки строки выглядит следующим образом:

```sql
REPLACE [INTO] table_name(column_list)
VALUES(value_list);
```

### Изменение строки

Синтаксис для изменения строки выглядит следующим образом:

```sql
REPLACE INTO table
SET column1 = value1,
    column2 = value2;
```

Так же можно добавить сюда выражение `WHERE`.

В отличие от выражения `UPDATE`, если не передать в `REPLACE` значение каких либо колонок, то он установит туда значения по умолчанию.

### Вставка из `SELECT`

Ниже показан оператор `REPLACE`, который вставляет данные в таблицу с данными, полученными из запроса.

```sql
REPLACE INTO table_1(column_list)
SELECT column_list
FROM table_2
WHERE where_condition;
```

Выражение аналогично `INSERT INTO SELECT`.


