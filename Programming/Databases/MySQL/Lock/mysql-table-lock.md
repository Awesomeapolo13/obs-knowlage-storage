
# Блокировка таблиц

**Ключи:**
- Обратные:
	- [MySQL](MySQL);
- Прямые:
	- [Deadlock](mysql-dead-lock)

**Хештеги:** 
- #Programming/Databases/MySQL/Lock
- #Programming/Databases/Lock

## Определение

Блокировка — это флаг, связанный с таблицей. MySQL позволяет клиентскому сеансу явно блокировать таблицу, чтобы другие сеансы не могли получить доступ к той же таблице в течение определенного периода.

Клиентский сеанс может устанавливать или снимать блокировки таблиц только для себя. Клиентский сеанс не может устанавливать или снимать блокировки таблиц для других клиентских сеансов.

![[Pasted image 20240821121340.png]]

## Выражение блокирования и разблокирования таблиц

Выражение ниже позволяет заблокировать таблицу:

```mysql
LOCK TABLES table_name [READ | WRITE]
```

Здесь мы определяем имя таблицы, которую хотим заблокировать. Так же, в дополнение, мы можем указать тип блокировки.

Блокировка может включать в себя несколько таблиц, перечисленных через запятую:

```mysql
LOCK TABLES table_name1 [READ | WRITE], 
            table_name2 [READ | WRITE],
             ... ;
```

Для разблокирования таблиц нужно выполнить выражение ниже:

```mysql
UNLOCK TABLES;
```

## Блокировки READ

У блокировки `READ` есть следующие особенности:
- Блокировка `READ` для таблицы может быть получена несколькими сеансами одновременно. Кроме того, другие сеансы могут читать данные из таблицы без установки блокировки.
- Сеанс, который удерживает блокировку `READ`, может только читать данные из таблицы, но не может записывать (вернет ошибку). А другие сеансы не могут записывать данные в таблицу, пока не будет снята блокировка `READ`. Операции записи из *другого* сеанса будут переведены в состояние ожидания до тех пор, пока не будет снята блокировка `READ`.
- Если сеанс завершается, как успешно, так нет, MySQL неявно снимет все блокировки. Эта функция также относится к блокировке `WRITE`.

Чтобы посмотреть детальную информацию о происходящих процессах, можно использовать выражени ниже:

```mysql
SHOW PROCESSLIST;
```

## Блокировки WRITE

У блокировки `WRITE` есть следующие особенности:
- Единственный сеанс, который удерживает блокировку таблицы, может читать и записывать данные из таблицы.
- Другие сеансы не могут читать данные и записывать данные в таблицу, пока не будет снята блокировка `WRITE`.

Операции чтения и записи из другой сессии будут поставлены в очередь для ожидания снятия блокировки.
