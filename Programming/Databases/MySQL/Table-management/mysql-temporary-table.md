
# Временные тыблицы

**Ключи:**
- Обратные:
	- [MySQL](MySQL);
	- [Работа с таблицами](mysql-table-management)
- Прямые:
	- [Механизмы хранения](mysql-storage-engine);
	- [Удаление таблицы](mysql-drop-table);

**Хештеги:** #Programming/Databases/MySQL/Tables

## Определение

В MySQL временная таблица — это особый тип таблицы, который позволяет хранить временный набор результатов, который можно повторно использовать несколько раз за один сеанс.

Такие таблицы удобны, когда невозможно или слишком затратно получать данные в одном `SELECT`. В этих случаях можно использовать временную таблицу для хранения немедленных результатов и выполнить дргугой запрос для их обработки.

## Функционал

Временные таблицы имеют следующий функционал:

1) Создается выражением `CREATE TEMPORARY TABLE`.
2) MySQL удаляет временную таблицу автоматически после завершения сеанса или разрыва соединения с БД. Так же можно использовать `DROP TABLE` для её удаления.
3) Временная таблица доступна и видна только тому клиенту, который ее создает. Поэтому разные клиенты могут создавать временные таблицы с одинаковыми именами и это не вызовет никаких ошибок. Однако, в рамках одной сессии создавать временные таблицы с одинаковыми именами нельзя.
4) Имя временной таблицы можен совпадать с именем постоянной (*regular*) таблицы. Но создание такой таблицы вызывает перехват всех запросов, адресованных постоянной таблице. Т.е. везде где мы обращаемся к ней, мы на самом деле обращаемся к временной таблице. После удаления временной таблицы, доступ к постоянной таблице восстанавливается. Тем не менее не рекомендуется называть временные таблицы так же как постоянные, потому как это может привести к путанице и потере данных. Например, после потери соединения с БД уже не понятно с какой таблицей мы работаем и можно случайно удалить регулярную таблицу вместо временной. Однако можно использовать `DROP TEMPORARY TABLE` выражение.

## Примеры

Синтаксис создания временной таблицы похож на синтаксис:

```sql
CREATE TEMPORARY TABLE table_name(
   column1 datatype constraints,
   column1 datatype constraints,
   ...,
   table_constraints
);
```

Пример:

```sql
CREATE TEMPORARY TABLE credits(
  customerNumber INT PRIMARY KEY, 
  creditLimit DEC(10, 2)
);
```

Затем наполняем таблицу:

```sql
INSERT INTO credits(customerNumber, creditLimit)
SELECT 
  customerNumber, 
  creditLimit 
FROM 
  customers 
WHERE 
  creditLimit > 0;
```

Так же можно создать таблицу, которая базируется на уже существующей таблицы, но использовать для этого выражение `CREATE TEMPORARY TABLE ... LIKE` нельзя.

```sql
CREATE TEMPORARY TABLE temp_table_name
SELECT * FROM original_table
LIMIT 0;
```

Пример:

```sql
CREATE TEMPORARY TABLE top_customers
SELECT p.customerNumber, 
       c.customerName, 
       ROUND(SUM(p.amount),2) sales
FROM payments p
INNER JOIN customers c ON c.customerNumber = p.customerNumber
GROUP BY p.customerNumber
ORDER BY sales DESC
LIMIT 10;
```

Для удаления же используется синтаксис:

```sql
DROP TEMPORARY TABLE table_name;
```
