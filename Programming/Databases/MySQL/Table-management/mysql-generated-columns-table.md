
# Генерируемые колонки

**Ключи:**
- Обратные:
	- [MySQL](MySQL);
	- [Работа с таблицами](mysql-table-management)
- Прямые:
	- [Создать таблицу](mysql-create-table);

**Хештеги:** #Programming/Databases/MySQL/Tables

## Определение

По умолчанию после создания таблицы с помощью `CREATE TABLE` мы используем выражения INSERT, UPDATE и DELETE для модификации её данных напрямую. Однако с версии MySQL 5.7 возможно использование так называемых генерируемых колонок. Они имеют такое название, потому как эти колонки рассчитываются на основе предопределенных выражений.

Пример создания такой таблицы см. ниже. В таблице `contracts` мы определяем `fullname` как конкатенацию колонок `first_name` и `last_name` .

```sql
CREATE TABLE contacts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    fullname varchar(101) GENERATED ALWAYS AS (CONCAT(first_name,' ',last_name)),
    email VARCHAR(100) NOT NULL
);
```

Где синтаксис генерируемой колонки:

```sql
GENERATED ALWAYS as (expression)
```

Теперь при выполнении операций `INSERT` или `UPDATE` колонка `full_name` будет заполняться на лету на основе значений внесенных в столбцах `first_name` и `last_name`.

MySQL предоставляет два типа генерируемых столбцов: хранимые (*stored*) и виртуальные (*virtual*). Виртуальные столбцы вычисляются «на лету» каждый раз, когда считываются данные, тогда как сохраненные столбцы вычисляются и сохраняются физически при обновлении данных.

Основываясь на этих определениях `full_name` - виртуальная колонка.

## Синтаксис

Синтаксис определения генерируемой колонки:

```sql
column_name data_type [GENERATED ALWAYS] AS (expression)
   [VIRTUAL | STORED] [UNIQUE [KEY]]
```

Сначала определяем имя колонки `column_name` и тип данных `data_type`.

Затем добавляем выражение `GENERATED ALWAYS`, чтобы обозначить колонку как генерируемую.

Потом, устанавливаем тип генерируемого столбца используя опции `VIRTUAL` или `STORED`. По умолчанию MySQL использует `VIRTUAL`.

Теперь можно определить выражение в скобках после ключевого слова `AS` Выражение может содержать литералы и встроенные функции без параметров, операторов или ссылок на какой-либо столбец в одной таблице. Если вы используете функцию, она должна быть скалярной и детерминированной. 

Как итог, если тип сгенерированной колонки хранимый, то можно установить для неё ограничения.

