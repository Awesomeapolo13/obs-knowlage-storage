
#  Оператор `EXISTS`

**Ключи:**
- Обратные:
	- [SQL](SQL);
	- [Реляционные БД](relative);
	- [Операторы](sql-operators);
- Прямые:
	- [Подзапросы](sql-subquery);

**Хештеги:** #Programming/Databases/SQL/Operator 

## Определение

Оператор `EXISTS` — это логический оператор, который возвращает значение `true` или `false`. Оператор `EXISTS` часто используется для проверки существования строк, возвращаемых подзапросом.

```sql
SELECT 
    select_list
FROM
    a_table
WHERE
    [NOT] EXISTS(subquery);
```

Если подзапрос возвращает хотя бы одну строку, оператор `EXISTS` возвращает `true`, в противном случае — `false`.

Кроме того, оператор `EXISTS` немедленно прекращает дальнейшую обработку, как только находит соответствующую строку, что может помочь повысить производительность запроса.

Оператор `NOT` отменяет оператор `EXISTS`. Другими словами, `NOT EXISTS` возвращает `true`, если подзапрос не возвращает ни одной строки, в противном случае он возвращает `false`.

Стоит отметить, что можно использовать `SELECT *`, `SELECT столбец`, `SELECT a_constant` или что-нибудь еще в подзапросе. Результаты те же, поскольку MySQL игнорирует список выбора, который появился в предложении `SELECT`.

Запрос, использующий оператор `EXISTS`, выполняется намного быстрее, чем запрос, использующий оператор `IN`. Причина в том, что оператор `EXISTS` работает по принципу «по крайней мере найден». `EXISTS` прекращает сканирование таблицы, когда найдена соответствующая строка. С другой стороны, когда оператор `IN` объединяется с подзапросом, MySQL должен сначала обработать подзапрос, а затем использовать результат подзапроса для обработки всего запроса.

Общее практическое правило заключается в том, что если подзапрос содержит большой объем данных, оператор `EXISTS` обеспечивает лучшую производительность. Однако запрос, использующий оператор `IN`, будет выполняться быстрее, если набор результатов, возвращаемый подзапросом, очень мал.

## Пример

В следующей операции `EXISTS` используется для поиска клиента, у которого есть хотя бы один заказ:

```sql
SELECT 
    customerNumber, 
    customerName
FROM
    customers
WHERE
    EXISTS(
	SELECT 
            1
        FROM
            orders
        WHERE
            orders.customernumber 
		= customers.customernumber);
```

В этом примере к добавочному номеру телефона сотрудников, работающих в офисе в Сан-Франциско, добавляется цифра 1:

```sql
UPDATE employees 
SET 
    extension = CONCAT(extension, '1')
WHERE
    EXISTS( 
        SELECT 
            1
        FROM
            offices
        WHERE
            city = 'San Francisco'
                AND offices.officeCode = employees.officeCode);
```

